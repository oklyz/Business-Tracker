{% extends "base_bank.html" %}
{% load humanize %}
<div class="request-detail-container">
{% block content %}
  <!-- <div class="request_detail">
    <h1>Company name: {{ request.business.brand }}</h1>
    <h3>Owner name: {{ request.business.user.username }}</h3>
    <h3>Borrow amount: {{ request.borrow_amount }}</h3>
    <p>Description: {{ request.description }}</p>
    {% if request.status == "P" %}
    <h3>Status request: <span class="pending">
    Pending</span></h3>
    {% elif request.status == "A" %}
    <h3>Status request: <span class="accepted">
    Accepted</span></h3>
    {% else %}
    <h3>Status request: <span class="rejected">
    Rejected</span></h3>
    {% endif %}
  </div> -->


  <div class="request-info">
    <div class="company-header">
        <h1 class="company-name">{{ request.business.brand }}</h1>
        <div class="status-badge {% if request.status == 'P' %}pending{% elif request.status == 'A' %}accepted{% else %}rejected{% endif %}">
            {{ request.get_status_display }}
        </div>
    </div>

    <div class="request-meta">
        <div class="meta-item">
            <span class="meta-label">Owner</span>
            <span class="meta-value">{{ request.business.user.username }}</span>
        </div>
        <div class="meta-item">
            <span class="meta-label">Amount Requested</span>
            <span class="meta-value">${{ request.borrow_amount|floatformat:2|intcomma }}</span>
        </div>
    </div>

    <div class="request-description">
        <h3>Request Description</h3>
        <p>{{ request.description }}</p>
    </div>
  </div>


  <div class="financial-tables-container">

  <!-- Balance Sheet Table -->
    <div class="table-container">
    {% if balance_sheets %}
      <h3>Balance Sheet</h3>
      <table class="">
        <thead>
          <tr>
            <th>Years</th>
            {% for sheet in balance_sheets %}
            <th>
              {{ sheet.year }}
            </th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Current Assets</strong></td>
            {% for sheet in balance_sheets %}
            <td>${{ sheet.current_assets|floatformat:2|intcomma }}</td>
            {% endfor %}
          </tr>
          <tr>
            <td><strong>Non-Current Assets</strong></td>
            {% for sheet in balance_sheets %}
            <td>${{ sheet.non_current_assets|floatformat:2|intcomma }}</td>
            {% endfor %}
          </tr>
          <tr>
            <td><strong>Cash & Equivalents</strong></td>
            {% for sheet in balance_sheets %}
            <td>${{ sheet.cash_equivalents|floatformat:2|intcomma }}</td>
            {% endfor %}
          </tr>
          <tr>
            <td><strong>Current Liabilities</strong></td>
            {% for sheet in balance_sheets %}
            <td>${{ sheet.current_liabilities|floatformat:2|intcomma }}</td>
            {% endfor %}
          </tr>
          <tr>
            <td><strong>Non-Current Liabilities</strong></td>
            {% for sheet in balance_sheets %}
            <td>${{ sheet.non_current_liabilities|floatformat:2|intcomma }}</td>
            {% endfor %}
          </tr>
          <tr>
            <td><strong>Shareholders Equity</strong></td>
            {% for sheet in balance_sheets %}
            <td>${{ sheet.shareholders_equity|floatformat:2|intcomma }}</td>
            {% endfor %}
          </tr>
        </tbody>
      </table>
      {% else %}
      <p>No balance sheets available.</p>
      {% endif %}
    </div>


    <!-- Income Statement Table -->
    <div class="table-container">
    {% if income_statements %}
      <h3>Income Statement</h3>
      <table>
        <thead>
          <tr>
            <th>Years</th>
            {% for statement in income_statements %}
            <th>
              {{ statement.year }}
            </th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Revenue</strong></td>
            {% for statement in income_statements %}
            <td>${{ statement.revenue|floatformat:2|intcomma }}</td>
            {% endfor %}
          </tr>
          <tr>
            <td><strong>Non Cash Expense</strong></td>
            {% for statement in income_statements %}
            <td>${{ statement.non_cash_expense|floatformat:2|intcomma }}</td>
            {% endfor %}
          </tr>
          <tr>
            <td><strong>Cost of Goods Sold</strong></td>
            {% for statement in income_statements %}
            <td>${{ statement.cogs|floatformat:2|intcomma }}</td>
            {% endfor %}
          </tr>
          <tr>
            <td><strong>Operating Expenses</strong></td>
            {% for statement in income_statements %}
            <td>${{ statement.operating_expenses|floatformat:2|intcomma }}</td>
            {% endfor %}
          </tr>
          <tr>
            <td><strong>Net Income</strong></td>
            {% for statement in income_statements %}
            {% if statement.net_income < 0 %}
              <td style="color:red;">(${{ statement.net_income|floatformat:2|intcomma|slice:'1:' }})</td>
            {% else %}
              <td>${{ statement.net_income|floatformat:2|intcomma }}</td>
            {% endif %}
            {% endfor %}
          </tr>
        </tbody>
      </table>
      {% else %}
      <p>No income statements available.</p>
      {% endif %}
    </div>

    </div>


    <div class="dscr-section">
        <div class="dscr-card {% if DSCR > 1 %}safe{% else %}risky{% endif %}">
            <h2>Debt Service Coverage Ratio</h2>
            <div class="dscr-value">{{ DSCR|floatformat:2 }}</div>
            <p class="dscr-status">
                {% if DSCR > 1 %}
                Safe to proceed with loan
                {% else %}
                Risky to proceed with loan
                {% endif %}
            </p>
            <a href="{% url 'request_update' request.id %}" class="next-btn">Proceed to Decision</a>
        </div>
    </div>



  <!-- <div>
    {% if DSCR > 1 %}
    <h1 class="safe">DSCR: {{ DSCR }} safe to loan</h1>
    {% else %}
    <h1 class="risky">DSCR: {{ DSCR }} risky to loan</h1>
    {% endif %}
  </div> -->

  <!-- <div>
    <a href="{% url 'request_update' request.id %}">Next</a>
  </div> -->
</div>
{% endblock %}